<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Matching Reveal Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
   body {
    margin: 0;
    padding: 0;
    font-family: 'Quicksand', sans-serif;
    background: url('space.jpg');
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

    .instructions {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      text-align: center;
      margin-bottom: 20px;
      transition: opacity 0.5s ease;
    }

    .instructions h1 {
      margin-top: 0;
      font-weight: 600;
    }

    .start-button {
      background: #ff8563;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      color: white;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .start-button:hover {
      background: #ff6843;
    }

    .game-board {
      display: none;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      max-width: 840px;
      margin-top: 20px;
    }

    .game-tile {
      width: 70px;
      height: 90px;
      background: linear-gradient(to top left, #fef9f5, #f3e5dc);
      border: 3px solid #d8b49c;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: bold;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      margin: 4px;
    }

    .game-tile:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 4px 6px 14px rgba(0, 0, 0, 0.2);
    }

    .audio-container {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 100;
      width: 300px;
      height: 150px;
      border-radius: 16px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      padding: 20px;
      animation: none;
      opacity: 0;
      text-align: center;
    }

    .audio-player {
      width: 100%;
      margin-top: 20px;
    }

    @keyframes flashingAppear {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
      25% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.02); }
      50% { opacity: 0.5; transform: translate(-50%, -50%) scale(0.98); }
      75% { opacity: 0.9; transform: translate(-50%, -50%) scale(1.01); }
      100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    .audio-container.reveal {
      display: block;
      animation: flashingAppear 2s ease forwards;
    }

    /* Enhanced Birthday Message Styles */
    .birthday-message {
      position: fixed;
      top: 30%;
      left: 0;
      width: 100%;
      z-index: 9999;
      text-align: center;
      pointer-events: none;
      display: none;
    }

    .birthday-text {
      font-family: 'Dancing Script', cursive;
      font-size: 85px;
      font-weight: 700;
      color: white;
      text-shadow: 
        -4px -4px 0 #000,
        4px -4px 0 #000,
        -4px 4px 0 #000,
        4px 4px 0 #000,
        0 0 15px rgba(255, 255, 255, 0.7);
      display: inline-block;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 20px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
      100% { transform: translateY(0px); }
    }

    .confetti {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 99;
    }
  </style>
</head>
<body>
  <div class="instructions" id="instructionsBox">
    <h1>Welcome to the Matching Game!</h1>
    <p>Match the tiles to reveal a surprise!</p>
    <button class="start-button" onclick="startGame()">Start Game</button>
  </div>
  <div class="game-board" id="gameBoard"></div>
  
  <div class="audio-container" id="audioContainer">
    <h3>Your special message is playing!</h3>
    <audio id="audioPlayer" class="audio-player" controls>
      <source src="./bowiemessage.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>
  </div>

  <!-- Birthday message with enhanced visibility -->
  <div class="birthday-message" id="birthdayMessage">
    <div class="birthday-text">Happy Birthday Sarah!</div>
  </div>
  
  <div class="confetti" id="confetti"></div>
  
  <audio id="clickSound" src="./mouse-click-sound-233951.mp3" preload="auto"></audio>
  <audio id="matchSound" src="./bubblepop-254773.mp3" preload="auto"></audio>
  <audio id="winSound" src="./success-fanfare-trumpets-6185.mp3" preload="auto"></audio>
  <audio id="envelopeSound" src="./envelope-open-sound.mp3" preload="auto"></audio>

  <script>
    const symbols = ['⚡','👩‍🎤','🎸','꩜','🚀','🛸','💽','👨‍🚀','🎵','🌈','🔮','👽'];
    const tiles = symbols.concat(symbols); // double the symbols for matching
    let firstTile = null;
    let canClick = true;

    function shuffleArray(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    function startGame() {
      const gameBoard = document.getElementById('gameBoard');
      document.getElementById('audioContainer').style.display = 'none';
      document.getElementById('birthdayMessage').style.display = 'none';
      document.getElementById('instructionsBox').style.opacity = '1';
      gameBoard.style.display = 'flex';
      gameBoard.innerHTML = '';

      const shuffled = shuffleArray([...tiles]);
      shuffled.forEach((symbol, index) => {
        const tile = document.createElement('div');
        tile.className = 'game-tile';
        tile.dataset.symbol = symbol;
        tile.dataset.index = index;
        tile.innerText = '';
        tile.onclick = () => handleTileClick(tile);
        gameBoard.appendChild(tile);
      });
    }

    function handleTileClick(tile) {
      if (!canClick || tile.innerText !== '') return;
      const clickSound = document.getElementById('clickSound');
      clickSound.currentTime = 0;
      clickSound.play();

      tile.innerText = tile.dataset.symbol;

      if (!firstTile) {
        firstTile = tile;
      } else {
        canClick = false;
        if (firstTile.dataset.symbol === tile.dataset.symbol && firstTile !== tile) {
          const matchSound = document.getElementById('matchSound');
          matchSound.currentTime = 0;
          matchSound.play();
          firstTile = null;
          canClick = true;
          checkWin();
        } else {
          setTimeout(() => {
            tile.innerText = '';
            firstTile.innerText = '';
            firstTile = null;
            canClick = true;
          }, 1000);
        }
      }
    }

    function checkWin() {
      const allTiles = document.querySelectorAll('.game-tile');
      const allRevealed = [...allTiles].every(tile => tile.innerText !== '');
      if (allRevealed) {
        // Hide the game board and instructions
        document.getElementById('gameBoard').style.display = 'none';
        document.getElementById('instructionsBox').style.opacity = '0';
        
        // Play win sound
        const winSound = document.getElementById('winSound');
        if(winSound) {
          winSound.currentTime = 0;
          winSound.play();
        }
        
        // Play envelope sound
        const envelopeSound = document.getElementById('envelopeSound');
        if(envelopeSound) {
          envelopeSound.currentTime = 0;
          envelopeSound.play();
        }
        
        // Create confetti
        createConfetti();
        
        // Show the birthday message immediately and prominently
        showBirthdayMessage();
        
        // Show audio player with animation effect
        setTimeout(() => {
          const audioContainer = document.getElementById('audioContainer');
          audioContainer.classList.add('reveal');
          
          // Play the audio explicitly
          const audioPlayer = document.getElementById('audioPlayer');
          audioPlayer.load(); // Important to refresh the audio element
          audioPlayer.play().catch(e => console.error("Audio play error:", e));
        }, 500);
      }
    }

    // Dedicated function to ensure birthday message shows
    function showBirthdayMessage() {
      const birthdayMessage = document.getElementById('birthdayMessage');
      
      // Force the message to be visible with inline styles
      birthdayMessage.style.display = 'block';
      birthdayMessage.style.opacity = '1';
      birthdayMessage.style.visibility = 'visible';
      
      // Create a backup timer to show the message again if needed
      setTimeout(() => {
        console.log("Re-ensuring birthday message visibility");
        birthdayMessage.style.display = 'block';
        birthdayMessage.style.opacity = '1';
        birthdayMessage.style.visibility = 'visible';
      }, 2500);
    }

    function createConfetti() {
      const confettiContainer = document.getElementById('confetti');
      const colors = ['#ff8563', '#ffce47', '#a5dd9b', '#60c1e8', '#f588eb'];
      
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'absolute';
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = Math.random() * 10 + 5 + 'px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = -20 + 'px';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.opacity = Math.random() * 0.7 + 0.3;
        
        confettiContainer.appendChild(confetti);
        
        // Animate confetti
        const duration = Math.random() * 3 + 2;
        const rotation = Math.random() * 360;
        
        confetti.animate([
          { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
          { transform: `translateY(100vh) rotate(${rotation}deg)`, opacity: 0 }
        ], {
          duration: duration * 1000,
          easing: 'cubic-bezier(0.17, 0.67, 0.83, 0.67)',
          fill: 'forwards'
        });
        
        // Remove confetti element after animation
        setTimeout(() => {
          confetti.remove();
        }, duration * 1000);
      }
    }
    
    // Initialize elements on page load
    window.addEventListener('DOMContentLoaded', () => {
      console.log("Page loaded, initializing elements");
    });
  </script>
</body>
</html>